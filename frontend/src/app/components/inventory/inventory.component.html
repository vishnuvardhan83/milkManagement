<div class="inventory-page">
  <div class="inventory-container">
    <div class="inventory-header">
      <div>
        <h1 class="inventory-title">Inventory Management</h1>
        <p class="inventory-subtitle">
          Manage daily stock, prices, and inventory entries for your dairy products
        </p>
      </div>
      <button mat-raised-button color="primary" class="add-product-btn" (click)="openAddProductDialog()">
        <mat-icon>add</mat-icon>
        Add New Product
      </button>
    </div>

    <mat-card class="update-card">
      <h2 class="section-title">{{ editingEntry ? 'Edit Inventory Entry' : 'Add / Update Daily Inventory' }}</h2>

      <form [formGroup]="inventoryForm" class="inventory-form">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Date</mat-label>
          <input
            matInput
            [matDatepicker]="picker"
            formControlName="date"
          />
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Product</mat-label>
          <mat-select
            formControlName="productId"
            (selectionChange)="onProductChange()"
          >
            <mat-option *ngFor="let p of products" [value]="p.id">
              {{ p.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Total Liters Received</mat-label>
          <input
            matInput
            type="number"
            formControlName="totalLitersReceived"
          />
          <mat-icon matSuffix>local_drink</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Price per Liter (₹)</mat-label>
          <input
            matInput
            type="number"
            formControlName="pricePerLitre"
          />
          <mat-icon matSuffix>currency_rupee</mat-icon>
        </mat-form-field>

        <div class="form-actions">
          <button
            mat-raised-button
            class="primary-button"
            (click)="saveInventory()"
            [disabled]="inventoryForm.invalid || loading"
            type="button"
          >
            <mat-icon>{{ editingEntry ? 'save' : 'add' }}</mat-icon>
            <span>{{ editingEntry ? 'Update Entry' : 'Add / Update Inventory' }}</span>
          </button>

          <button
            mat-stroked-button
            color="primary"
            class="secondary-button"
            type="button"
            (click)="cancelEdit()"
            *ngIf="editingEntry"
          >
            Cancel
          </button>

          <button
            mat-stroked-button
            color="primary"
            class="secondary-button"
            type="button"
            (click)="resetForm()"
            *ngIf="!editingEntry"
          >
            Reset
          </button>
        </div>
      </form>
    </mat-card>

    <mat-card class="current-card" *ngIf="status">
      <h2 class="section-title">Current Inventory Status</h2>
      <div class="current-grid">
        <div class="current-item date-card">
          <div class="label">Date</div>
          <div class="value">{{ status.date }}</div>
        </div>
        <div class="current-item received-card">
          <div class="label">Total Received</div>
          <div class="value">{{ status.totalReceived }}L</div>
        </div>
        <div class="current-item available-card">
          <div class="label">Available</div>
          <div class="value">{{ status.available }}L</div>
        </div>
        <div class="current-item price-card">
          <div class="label">Price/Liter</div>
          <div class="value">₹{{ status.pricePerLitre }}</div>
        </div>
      </div>
    </mat-card>

    <mat-card class="entries-card">
      <div class="entries-header">
        <h2 class="section-title">Inventory History</h2>
        <button mat-icon-button (click)="loadInventoryEntries()" [disabled]="loading" matTooltip="Refresh">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>

      <div class="table-container" *ngIf="!loading && inventoryEntries.length > 0">
        <table mat-table [dataSource]="inventoryEntries" class="inventory-table">
          <ng-container matColumnDef="entryDate">
            <th mat-header-cell *matHeaderCellDef>Date</th>
            <td mat-cell *matCellDef="let entry">{{ entry.entryDate }}</td>
          </ng-container>

          <ng-container matColumnDef="productName">
            <th mat-header-cell *matHeaderCellDef>Product</th>
            <td mat-cell *matCellDef="let entry">{{ entry.productName }}</td>
          </ng-container>

          <ng-container matColumnDef="totalLitersReceived">
            <th mat-header-cell *matHeaderCellDef>Liters Received</th>
            <td mat-cell *matCellDef="let entry">{{ entry.totalLitersReceived }}L</td>
          </ng-container>

          <ng-container matColumnDef="pricePerLitre">
            <th mat-header-cell *matHeaderCellDef>Price/Liter</th>
            <td mat-cell *matCellDef="let entry">₹{{ entry.pricePerLitre }}</td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let entry">
              <button mat-icon-button color="primary" (click)="editEntry(entry)" matTooltip="Edit">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="deleteEntry(entry)" matTooltip="Delete">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>

      <div class="no-entries" *ngIf="!loading && inventoryEntries.length === 0">
        <mat-icon>inventory_2</mat-icon>
        <p>No inventory entries found. Add your first inventory entry above.</p>
      </div>

      <div class="loading-spinner" *ngIf="loading">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
    </mat-card>
  </div>
</div>
