<div class="product-list-container">
  <div class="header">
    <h1>All Products</h1>
    <div class="header-actions">
      <div class="product-count">
        <span class="count-label">Total:</span>
        <span class="count-value">{{ allProducts.length }}</span>
        <span class="count-label" *ngIf="filteredProducts.length !== allProducts.length">
          (Showing: {{ filteredProducts.length }})
        </span>
      </div>
      <button *ngIf="isAdminOrManager()" mat-raised-button color="primary" (click)="openAddDialog()">
        <mat-icon>add</mat-icon>
        Add Product
      </button>
    </div>
  </div>

  <!-- Search and Filter Toolbar -->
  <div class="search-filter-toolbar">
    <div class="toolbar-left">
      <span class="display-count">Displaying {{ filteredProducts.length }} of {{ allProducts.length }}</span>
      <mat-form-field appearance="outline" class="compact-search-field">
        <input matInput [formControl]="searchControl" placeholder="Search">
        <mat-icon matPrefix>search</mat-icon>
      </mat-form-field>
    </div>
    <div class="toolbar-right">
      <button mat-icon-button (click)="toggleFilters()" [class.active]="showFilters" matTooltip="Filters">
        <mat-icon>filter_list</mat-icon>
      </button>
      <button mat-icon-button (click)="loadProducts()" matTooltip="Refresh">
        <mat-icon>refresh</mat-icon>
      </button>
    </div>
  </div>

  <!-- Expandable Filter Panel -->
  <div class="filter-panel" [class.expanded]="showFilters">
    <div class="filter-content">
      <mat-form-field appearance="outline" class="compact-filter-field">
        <mat-label>Name</mat-label>
        <input matInput [formControl]="filterNameControl" placeholder="Product name">
      </mat-form-field>

      <mat-form-field appearance="outline" class="compact-filter-field">
        <mat-label>Category</mat-label>
        <mat-select [formControl]="filterTypeControl">
          <mat-option value="">All</mat-option>
          <mat-option value="COW_MILK">Cow Milk</mat-option>
          <mat-option value="BUFFALO_MILK">Buffalo Milk</mat-option>
          <mat-option value="CURD">Curd</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="compact-filter-field">
        <mat-label>Min Price</mat-label>
        <input matInput type="number" [formControl]="minPriceControl" placeholder="0">
      </mat-form-field>

      <mat-form-field appearance="outline" class="compact-filter-field">
        <mat-label>Max Price</mat-label>
        <input matInput type="number" [formControl]="maxPriceControl" placeholder="1000">
      </mat-form-field>

      <button mat-button (click)="clearFilters()" class="clear-btn">
        <mat-icon>clear</mat-icon>
        Clear
      </button>
    </div>
  </div>

  <div class="table-wrapper">
    <div *ngIf="loading" class="loading">
      <mat-spinner></mat-spinner>
    </div>

    <div *ngIf="!loading && filteredProducts.length === 0" class="no-products">
      <mat-icon>inventory_2</mat-icon>
      <p>No products yet</p>
    </div>

    <div *ngIf="!loading && filteredProducts.length > 0" class="table-container">
      <table class="product-table">
        <thead>
          <tr>
            <th>Product ID</th>
            <th>Name</th>
            <th>Category</th>
            <th>Price per Unit (₹)</th>
            <th>Stock Quantity</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of filteredProducts">
            <td>{{ product.id }}</td>
            <td>{{ product.name }}</td>
            <td>{{ product.type }}</td>
            <td>₹{{ product.pricePerUnit | number:'1.2-2' }}</td>
            <td>{{ product.quantity | number:'1.2-2' }} {{ product.unit }}</td>
            <td class="actions-cell">
              <button mat-icon-button color="primary" (click)="openEditDialog(product)" matTooltip="Edit Product" *ngIf="isAdminOrManager()">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="deleteProduct(product.id!)" matTooltip="Delete Product" *ngIf="isAdminOrManager()">
                <mat-icon>delete</mat-icon>
              </button>
              <button mat-icon-button color="accent" (click)="addToCart(product)" matTooltip="Add to Cart" *ngIf="isCustomer()">
                <mat-icon>add_shopping_cart</mat-icon>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
